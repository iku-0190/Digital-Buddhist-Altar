
<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>デジタル仏壇 v6（自由配置・拡大縮小 / 仏具カタログ）</title>
<style>
  :root { --bg:#f6f6f6; --card:#fff; --accent:#c59d5f; --muted:#666; --text:#222; }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans JP","Hiragino Sans","Yu Gothic",Meiryo,sans-serif}
  header{position:sticky;top:0;background:var(--card);border-bottom:1px solid #eee;padding:12px 16px;z-index:10;display:flex;align-items:center;gap:8px;flex-wrap:wrap}
  h1{font-size:16px;margin:0}
  .container{max-width:900px;margin:0 auto;padding:12px}
  .bar{display:flex;gap:8px;flex-wrap:wrap}
  .btn{padding:10px 14px;border-radius:12px;border:1px solid var(--accent);background:var(--accent);color:#fff;font-weight:600;cursor:pointer}
  .btn-outline{background:#fff;color:var(--accent)}
  .btn-ghost{background:#fff;border:1px solid #ddd;color:#333}
  .stage-wrap{margin-top:12px;border:1px dashed #e8e0cf;border-radius:16px;overflow:hidden;background:#fcfbf8}
  .stage{position:relative;min-height:520px;display:block;touch-action:none}
  .altar-bg{position:absolute;inset:0;background:#f7f3ea}
  .altar-bg img{width:100%;height:100%;object-fit:cover;opacity:.9;filter:saturate(.95)}
  .canvas{position:relative;z-index:2;width:100%;height:100%}
  .hint{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);color:#777;font-size:13px;z-index:1;text-align:center}
  /* Placable item */
  .item{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%) scale(1);user-select:none;touch-action:none}
  .item img{display:block;max-width:240px;max-height:240px;width:220px;height:auto;border-radius:10px;box-shadow:0 8px 24px rgba(0,0,0,.12)}
  .item .label{position:absolute;left:50%;bottom:-20px;transform:translateX(-50%);font-size:12px;color:#333;background:rgba(255,255,255,.6);padding:2px 8px;border-radius:999px}
  .item .handle{position:absolute;right:-10px;bottom:-10px;width:22px;height:22px;border-radius:50%;background:#fff;border:2px solid var(--accent);display:grid;place-items:center;font-size:14px;color:var(--accent);cursor:nwse-resize}
  .item.selected{outline:2px dashed var(--accent);outline-offset:4px}
  .stack{position:absolute;right:8px;top:8px;display:flex;gap:6px;z-index:5}
  .stack .chip{padding:6px 10px;border:1px solid #ddd;border-radius:999px;background:#fff;font-size:12px;cursor:pointer}
  .stack .chip.active{border-color:var(--accent);background:#fff7e8}
  .note{color:#666;font-size:12px;text-align:center;margin:8px 0 18px}
  /* Bottom sheet */
  .sheetWrap{position:fixed;inset:0;display:none;align-items:flex-end;justify-content:center;background:rgba(0,0,0,.35);z-index:50}
  .sheet{width:100%;max-width:900px;background:var(--card);border-top-left-radius:20px;border-top-right-radius:20px;padding:16px;box-shadow:0 -8px 24px rgba(0,0,0,.2)}
  .grid{display:grid;grid-template-columns:repeat(3, 1fr);gap:12px}
  @media (min-width:720px){ .grid{grid-template-columns:repeat(6, 1fr);} }
  .entry{border:1px solid #eee;border-radius:12px;overflow:hidden;background:#fff;cursor:pointer;text-align:center}
  .entry .thumb{height:100px;background:#f3f3f3}
  .entry .thumb img{width:100%;height:100%;object-fit:cover}
  .entry .name{padding:8px 6px;font-size:12px;font-weight:700}
  .entry .type{font-size:11px;color:#777;padding-bottom:8px}
  .catalog-tabs{display:flex;gap:8px;margin-bottom:8px;flex-wrap:wrap}
  .chip{padding:8px 12px;border-radius:999px;border:1px solid #ddd;background:#fafafa;font-size:13px;cursor:pointer}
  .chip.active{border-color:var(--accent);background:#fff7e8}
</style>
</head>
<body>
<header>
  <h1>デジタル仏壇 v6</h1>
  <div class="bar">
    <button class="btn" id="btnAltar">仏壇を選ぶ</button>
    <a class="btn btn-outline" id="btnBuy" href="#" target="_blank" rel="noopener" aria-disabled="true">仏壇を購入</a>
    <button class="btn btn-outline" id="btnCatalog">仏具カタログ</button>
    <button class="btn-ghost" id="btnEdit">編集モード：OFF</button>
    <button class="btn-ghost" id="btnClear">片付ける（仏具のみ）</button>
  </div>
</header>

<div class="container">
  <div class="stage-wrap">
    <div class="stage" id="stage">
      <div class="altar-bg"><img id="altarBg" src="https://picsum.photos/seed/altarA/1600/1000" alt="仮の仏壇写真"></div>
      <div class="canvas" id="canvas"></div>
      <div class="hint" id="hint">「仏壇を選ぶ」→「仏具カタログ」で<br>御本尊・掛け軸・位牌・花立・おりん等を配置できます。<br>編集モードONでドラッグ＆拡大縮小可。</div>
      <div class="stack">
        <span class="chip" id="front">最前面へ</span>
        <span class="chip" id="back">最背面へ</span>
        <span class="chip" id="remove">削除</span>
      </div>
    </div>
  </div>
  <p class="note">※ 写真はプレースホルダー（picsum.photos）。後で実写に差し替え可。</p>
</div>

<!-- 仏壇シート -->
<div class="sheetWrap" id="sheetAltar">
  <div class="sheet">
    <h3 style="margin:0 0 8px">仏壇を選ぶ</h3>
    <div class="grid" id="altarGrid"></div>
    <p class="note">選択で背景が切り替わり、購入ボタンのリンクも更新されます（ダミー）。</p>
  </div>
</div>

<!-- カタログシート -->
<div class="sheetWrap" id="sheetCatalog">
  <div class="sheet">
    <div class="catalog-tabs" id="tabs">
      <button class="chip active" data-cat="main">本尊・掛け軸・位牌</button>
      <button class="chip" data-cat="vessels">供物・器類</button>
      <button class="chip" data-cat="bell">おりん・火立・香炉</button>
      <button class="chip" data-cat="tools">道具（マッチ消／線香差 など）</button>
    </div>
    <div class="grid" id="catalogGrid"></div>
  </div>
</div>

<script>
(function(){
  // 背景仏壇 + 購入リンク
  const ALTARS = [
    { id:'a', name:'仏壇A（明るめ木目）', img:'https://picsum.photos/seed/altarA/1600/1000', buy:'https://example.com/butsudanA' },
    { id:'b', name:'仏壇B（ダーク系）', img:'https://picsum.photos/seed/altarB/1600/1000', buy:'https://example.com/butsudanB' },
    { id:'c', name:'仏壇C（シンプル）', img:'https://picsum.photos/seed/altarC/1600/1000', buy:'https://example.com/butsudanC' },
    { id:'d', name:'仏壇D（金箔アクセント）', img:'https://picsum.photos/seed/altarD/1600/1000', buy:'https://example.com/butsudanD' },
  ];

  // カタログ（仮画像）
  const CATALOG = {
    main: [
      { id:'gohonzon', name:'御本尊', img:'https://picsum.photos/seed/gohonzon/600/800' },
      { id:'kakejiku', name:'掛け軸', img:'https://picsum.photos/seed/kakejiku/600/800' },
      { id:'ihai-s', name:'位牌（小）', img:'https://picsum.photos/seed/ihaiS/400/600' },
      { id:'ihai-m', name:'位牌（中）', img:'https://picsum.photos/seed/ihaiM/500/750' },
      { id:'ihai-l', name:'位牌（大）', img:'https://picsum.photos/seed/ihaiL/600/900' },
    ],
    vessels: [
      { id:'buppanki', name:'仏飯器', img:'https://picsum.photos/seed/buppanki/800/600' },
      { id:'chayuuki', name:'茶湯器', img:'https://picsum.photos/seed/chayuuki/800/600' },
      { id:'hanadate', name:'花立', img:'https://picsum.photos/seed/hanadate/800/600' },
      { id:'takatsuki', name:'高月', img:'https://picsum.photos/seed/takatsuki/800/600' },
      { id:'buppanzen', name:'仏飯膳', img:'https://picsum.photos/seed/buppanzen/800/600' },
    ],
    bell: [
      { id:'orin', name:'おりん', img:'https://picsum.photos/seed/orin/800/600' },
      { id:'rinbo', name:'リン棒', img:'https://picsum.photos/seed/rinbo/800/600' },
      { id:'hidate', name:'火立', img:'https://picsum.photos/seed/hidate/800/600' },
      { id:'koro', name:'香炉', img:'https://picsum.photos/seed/koro/800/600' },
    ],
    tools: [
      { id:'matchkeshi', name:'マッチ消', img:'https://picsum.photos/seed/matchkeshi/800/600' },
      { id:'senkosashi-a', name:'線香差（A）', img:'https://picsum.photos/seed/senkosashiA/800/600' },
      { id:'senkosashi-b', name:'線香差（B）', img:'https://picsum.photos/seed/senkosashiB/800/600' },
      { id:'senkosashi-c', name:'線香差（C）', img:'https://picsum.photos/seed/senkosashiC/800/600' },
    ]
  };

  const stage = document.getElementById('stage');
  const canvas = document.getElementById('canvas');
  const hint = document.getElementById('hint');
  const btnAltar = document.getElementById('btnAltar');
  const sheetAltar = document.getElementById('sheetAltar');
  const altarGrid = document.getElementById('altarGrid');
  const altarBg = document.getElementById('altarBg');
  const btnBuy = document.getElementById('btnBuy');

  const btnCatalog = document.getElementById('btnCatalog');
  const sheetCatalog = document.getElementById('sheetCatalog');
  const catalogGrid = document.getElementById('catalogGrid');
  const tabs = document.getElementById('tabs');
  let currentCat = 'main';

  const btnEdit = document.getElementById('btnEdit');
  const btnClear = document.getElementById('btnClear');
  const front = document.getElementById('front');
  const back = document.getElementById('back');
  const remove = document.getElementById('remove');

  let editMode = false;
  let selected = null;
  let zCounter = 10;

  // 仏壇シート表示
  btnAltar.addEventListener('click', ()=>{ sheetAltar.style.display='flex'; renderAltars(); });
  sheetAltar.addEventListener('click', (e)=>{ if(e.target===sheetAltar) sheetAltar.style.display='none'; });

  function renderAltars(){
    altarGrid.innerHTML = '';
    ALTARS.forEach(a=>{
      const el = document.createElement('button');
      el.className='entry';
      el.innerHTML = `<div class="thumb"><img src="${a.img}" alt="${a.name}"></div>
                      <div class="name">${a.name}</div>
                      <div class="type">購入リンク更新</div>`;
      el.addEventListener('click', ()=>{
        altarBg.src = a.img;
        btnBuy.href = a.buy;
        btnBuy.setAttribute('aria-disabled','false');
        sheetAltar.style.display='none';
      });
      altarGrid.appendChild(el);
    });
  }

  // カタログ表示
  btnCatalog.addEventListener('click', ()=>{ sheetCatalog.style.display='flex'; renderCatalog(); });
  sheetCatalog.addEventListener('click', (e)=>{ if(e.target===sheetCatalog) sheetCatalog.style.display='none'; });

  tabs.addEventListener('click', (e)=>{
    if(e.target.matches('.chip')){
      tabs.querySelectorAll('.chip').forEach(c=>c.classList.remove('active'));
      e.target.classList.add('active');
      currentCat = e.target.dataset.cat;
      renderCatalog();
    }
  });

  function renderCatalog(){
    catalogGrid.innerHTML = '';
    (CATALOG[currentCat]||[]).forEach(item=>{
      const el = document.createElement('button');
      el.className='entry';
      el.innerHTML = `<div class="thumb"><img src="${item.img}" alt="${item.name}"></div>
                      <div class="name">${item.name}</div>
                      <div class="type">タップで追加</div>`;
      el.addEventListener('click', ()=>{
        addItem(item);
        sheetCatalog.style.display='none';
      });
      catalogGrid.appendChild(el);
    });
  }

  // アイテム追加
  function addItem(data){
    hint.style.display='none';
    const el = document.createElement('div');
    el.className='item';
    el.style.zIndex = (++zCounter).toString();
    el.innerHTML = `<img src="${data.img}" alt="${data.name}"><div class="label">${data.name}</div><div class="handle">↘</div>`;
    canvas.appendChild(el);
    makeInteractive(el);
    select(el);
  }

  // 編集モード
  btnEdit.addEventListener('click', ()=>{
    editMode = !editMode;
    btnEdit.textContent = '編集モード：' + (editMode ? 'ON' : 'OFF');
    // ハンドル表示/非表示
    canvas.querySelectorAll('.item .handle').forEach(h=>h.style.display = editMode ? 'grid' : 'none');
  });

  // 背景クリックで選択解除
  canvas.addEventListener('pointerdown', (e)=>{
    if(e.target===canvas){ select(null); }
  });

  // 選択/階層/削除
  front.addEventListener('click', ()=>{ if(selected){ selected.style.zIndex = (++zCounter).toString(); }});
  back.addEventListener('click', ()=>{ if(selected){ selected.style.zIndex = '1'; }});
  remove.addEventListener('click', ()=>{ if(selected){ selected.remove(); selected=null; }});

  // 片付け（仏具のみ）
  btnClear.addEventListener('click', ()=>{
    canvas.innerHTML = '';
    hint.style.display='block';
    selected=null;
  });

  // インタラクティブ化（ドラッグ＆リサイズ）
  function makeInteractive(el){
    const img = el.querySelector('img');
    const handle = el.querySelector('.handle');
    handle.style.display = editMode ? 'grid' : 'none';

    // ドラッグ
    let dragging = false;
    let startX=0, startY=0, baseLeft=0, baseTop=0;

    el.addEventListener('pointerdown', (e)=>{
      if(!editMode) return;
      if(e.target===handle) return; // リサイズは別
      dragging = true;
      el.setPointerCapture(e.pointerId);
      startX = e.clientX; startY = e.clientY;
      const rect = el.getBoundingClientRect();
      const parent = canvas.getBoundingClientRect();
      baseLeft = rect.left - parent.left;
      baseTop  = rect.top  - parent.top;
      select(el);
      e.preventDefault();
    });

    el.addEventListener('pointermove', (e)=>{
      if(!dragging) return;
      const dx = e.clientX - startX;
      const dy = e.clientY - startY;
      el.style.left = (baseLeft + dx) + 'px';
      el.style.top  = (baseTop  + dy) + 'px';
      el.style.transform = 'translate(0,0)';
    });

    el.addEventListener('pointerup', ()=>{ dragging=false; });
    el.addEventListener('pointercancel', ()=>{ dragging=false; });

    // リサイズ（右下ハンドル）
    let resizing = false;
    let startW=0, startH=0, rStartX=0, rStartY=0;
    handle.addEventListener('pointerdown', (e)=>{
      if(!editMode) return;
      resizing = true;
      handle.setPointerCapture(e.pointerId);
      rStartX = e.clientX; rStartY = e.clientY;
      startW = img.getBoundingClientRect().width;
      startH = img.getBoundingClientRect().height;
      select(el);
      e.preventDefault();
      e.stopPropagation();
    });
    handle.addEventListener('pointermove', (e)=>{
      if(!resizing) return;
      const dx = e.clientX - rStartX;
      const ratio = startW / startH;
      let newW = Math.max(40, startW + dx);
      img.style.width = newW + 'px';
      img.style.height = (newW/ratio) + 'px';
    });
    handle.addEventListener('pointerup', ()=>{ resizing=false; });
    handle.addEventListener('pointercancel', ()=>{ resizing=false; });

    // 選択状態の見た目
    el.addEventListener('click', ()=>{ if(editMode) select(el); });
  }

  function select(el){
    canvas.querySelectorAll('.item').forEach(i=>i.classList.remove('selected'));
    selected = el;
    if(el){ el.classList.add('selected'); }
  }

  // 初期：購入リンク有効化
  btnBuy.href = ALTARS[0].buy;
  btnBuy.setAttribute('aria-disabled','false');

})();
</script>
</body>
</html>
