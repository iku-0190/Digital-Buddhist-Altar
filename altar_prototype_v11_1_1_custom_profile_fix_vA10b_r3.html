<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>デジタル仏壇プロトタイプ vA10b_r3</title>
  <style>
    :root {
      color-scheme: dark;
    }
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", Arial,
        "游ゴシック体", "YuGothic", "メイリオ", sans-serif;
      background: radial-gradient(circle at top, #333 0, #000 55%);
      color: #f5f5f5;
      display: flex;
      justify-content: center;
    }
    .wrapper {
      max-width: 480px;
      width: 100%;
      min-height: 100vh;
      padding: 16px;
    }
    .altar {
      background: rgba(15, 15, 15, 0.92);
      border-radius: 18px;
      padding: 14px 14px 16px;
      box-shadow: 0 0 25px rgba(0, 0, 0, 0.75);
      border: 1px solid #444;
    }
    .section-title {
      font-size: 13px;
      letter-spacing: 0.08em;
      color: #bbb;
      text-transform: uppercase;
      margin-bottom: 6px;
    }
    .divider {
      height: 1px;
      margin: 10px 0 12px;
      background: linear-gradient(to right, transparent, #777, transparent);
    }
    /* プロフィール */
    .profile {
      display: flex;
      gap: 12px;
      align-items: center;
    }
    .portrait-frame {
      flex: 0 0 96px;
      padding: 6px;
      border-radius: 12px;
      border: 3px solid #f5f5f5;
      background: linear-gradient(135deg, #444, #111);
    }
    .portrait {
      height: 108px;
      border-radius: 8px;
      background: #555;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      color: #eee;
      text-align: center;
      padding: 4px;
    }
    .profile-text {
      flex: 1;
      font-size: 13px;
    }
    .profile-name {
      font-size: 17px;
      font-weight: 600;
      margin-bottom: 2px;
    }
    .profile-relation {
      font-size: 12px;
      color: #c8c8c8;
      margin-bottom: 6px;
    }
    .profile-message {
      font-size: 12px;
      color: #e0e0e0;
      line-height: 1.5;
    }
    .profile-edit-toggle {
      margin-top: 8px;
      text-align: right;
    }
    .link-like {
      font-size: 11px;
      color: #b0d5ff;
      text-decoration: underline;
    }
    .profile-form {
      margin-top: 8px;
      padding: 8px;
      border-radius: 10px;
      background: #171717;
      border: 1px solid #333;
      display: none;
    }
    .profile-form-row {
      margin-bottom: 6px;
    }
    .profile-form label {
      font-size: 11px;
      display: block;
      margin-bottom: 2px;
      color: #ccc;
    }
    .profile-form input,
    .profile-form textarea {
      width: 100%;
      border-radius: 8px;
      border: 1px solid #555;
      background: #101010;
      color: #f5f5f5;
      font-size: 12px;
      padding: 6px 8px;
    }
    .profile-form textarea {
      min-height: 44px;
      resize: vertical;
    }
    .profile-form-buttons {
      margin-top: 4px;
      display: flex;
      justify-content: flex-end;
      gap: 8px;
    }
    .btn {
      border-radius: 999px;
      padding: 6px 12px;
      font-size: 12px;
      border: 1px solid #666;
      background: #171717;
      color: #f8f8f8;
    }
    .btn-primary {
      border-color: #f5d27a;
      background: linear-gradient(135deg, #f5d27a, #b58b2a);
      color: #16130a;
      font-weight: 600;
    }
    .btn:active {
      opacity: 0.8;
    }
    /* お供え */
    .offerings-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 6px;
    }
    .offerings-header-right {
      font-size: 11px;
      color: #aaa;
    }
    .offerings-list {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      min-height: 44px;
    }
    .offering-card {
      flex: 0 1 calc(50% - 8px);
      background: radial-gradient(circle at top left, #444 0, #181818 55%);
      border-radius: 12px;
      padding: 8px;
      border: 1px solid #555;
      font-size: 12px;
    }
    .offering-main {
      font-weight: 600;
      margin-bottom: 4px;
    }
    .offering-brand {
      font-size: 11px;
      color: #f7e7b8;
      margin-bottom: 2px;
    }
    .offering-meta {
      font-size: 10px;
      color: #c0c0c0;
    }
    .offering-meta span {
      display: block;
    }
    .offering-add-area {
      margin-top: 10px;
      padding: 8px;
      border-radius: 12px;
      background: #151515;
      border: 1px solid #303030;
    }
    .offering-row {
      display: flex;
      gap: 6px;
      margin-bottom: 6px;
    }
    select,
    .offering-input {
      border-radius: 999px;
      border: 1px solid #555;
      background: #111;
      color: #f5f5f5;
      font-size: 12px;
      padding: 6px 9px;
      flex: 1;
      min-width: 0;
    }
    select {
      padding-right: 22px;
    }
    .offering-note {
      font-size: 10px;
      color: #aaa;
      line-height: 1.5;
    }
    /* フッターなど */
    .footer {
      margin-top: 10px;
      font-size: 11px;
      color: #888;
      text-align: center;
      line-height: 1.6;
    }
    .badge {
      display: inline-block;
      font-size: 10px;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid #666;
      margin-top: 4px;
    }
  </style>
</head>
<body>
  <div class="wrapper">
    <div class="altar">
      <!-- プロフィール -->
      <div class="section-title">Profile</div>
      <div class="profile">
        <div class="portrait-frame">
          <div class="portrait" id="portraitText">
            遺影（サンプル）<br />タップで変更は<br />アプリ版で実装予定
          </div>
        </div>
        <div class="profile-text">
          <div class="profile-name" id="profileName">山田 太郎 さん</div>
          <div class="profile-relation" id="profileRelation">あなたのおじいちゃん（父方）</div>
          <div class="profile-message" id="profileMessage">
            いつも見守ってくれてありがとう。<br />
            無理しすぎず、元気で過ごすんだよ。
          </div>
          <div class="profile-edit-toggle">
            <button id="toggleProfileForm" class="link-like" type="button">
              表示名・一言メッセージを変更する（端末内のみ）
            </button>
          </div>
        </div>
      </div>
      <form id="profileForm" class="profile-form">
        <div class="profile-form-row">
          <label for="nameInput">お名前</label>
          <input
            id="nameInput"
            type="text"
            placeholder="例）山田 太郎 さん"
          />
        </div>
        <div class="profile-form-row">
          <label for="relationInput">関係性</label>
          <input
            id="relationInput"
            type="text"
            placeholder="例）あなたのおじいちゃん（父方）"
          />
        </div>
        <div class="profile-form-row">
          <label for="messageInput">一言メッセージ</label>
          <textarea
            id="messageInput"
            placeholder="例）いつも見守ってくれてありがとう。無理しすぎず、元気で過ごすんだよ。"
          ></textarea>
        </div>
        <div class="profile-form-buttons">
          <button type="button" class="btn" id="cancelProfileEdit">キャンセル</button>
          <button type="button" class="btn btn-primary" id="saveProfile">
            この画面に反映する
          </button>
        </div>
      </form>

      <div class="divider"></div>

      <!-- お供え -->
      <div class="section-title">Offerings</div>
      <div class="offerings-header">
        <div>お供え一覧</div>
        <div class="offerings-header-right">タップで追加（サンプル動作）</div>
      </div>
      <div id="offeringsList" class="offerings-list"></div>

      <div class="offering-add-area">
        <div class="offering-row">
          <select id="categorySelect">
            <option value="線香">お線香</option>
            <option value="花">お花</option>
            <option value="甘味">甘いもの</option>
            <option value="飲み物">飲み物</option>
            <option value="その他">その他</option>
          </select>
          <select id="brandSelect">
            <option value="デジタル表示のみ">デジタル表示のみ</option>
            <option value="企業サンプル：和菓子店">企業サンプル：和菓子店</option>
            <option value="企業サンプル：ビールメーカー">企業サンプル：ビールメーカー</option>
            <option value="企業サンプル：コーヒーブランド">企業サンプル：コーヒーブランド</option>
          </select>
        </div>
        <div class="offering-row">
          <input
            id="customLabelInput"
            class="offering-input"
            type="text"
            placeholder="任意の品名（例：いちご大福、○○ビールなど）"
          />
          <button id="addOfferingBtn" class="btn btn-primary" type="button">
            お供えする
          </button>
        </div>
        <div class="offering-note">
          ※ここはデモ画面のため、実際の注文や決済は行われません。<br />
          将来のアプリ版では、企業コラボと連携し、<br />
          ご自宅へのお届けも選べるイメージです。
        </div>
      </div>

      <div class="divider"></div>

      <!-- フッター -->
      <div class="footer">
        デジタル仏壇アプリ プロトタイプ（HTML版） v11.1.1 / vA10b_r3<br />
        このファイルを GitHub 等にアップロードすることで、<br />
        スマホから「お仏壇ページ」として開くことができます。<br />
        <span class="badge">端末ローカルのみ・サーバー保存なし</span>
      </div>
    </div>
  </div>

  <script>
    // --- プロフィール編集 ---
    const toggleProfileFormBtn = document.getElementById("toggleProfileForm");
    const profileFormEl = document.getElementById("profileForm");
    const cancelProfileEditBtn = document.getElementById("cancelProfileEdit");
    const saveProfileBtn = document.getElementById("saveProfile");

    const nameInput = document.getElementById("nameInput");
    const relationInput = document.getElementById("relationInput");
    const messageInput = document.getElementById("messageInput");

    const profileNameEl = document.getElementById("profileName");
    const profileRelationEl = document.getElementById("profileRelation");
    const profileMessageEl = document.getElementById("profileMessage");

    let profileFormVisible = false;

    function toggleProfileForm(visible) {
      profileFormVisible =
        typeof visible === "boolean" ? visible : !profileFormVisible;
      profileFormEl.style.display = profileFormVisible ? "block" : "none";
      if (profileFormVisible) {
        // 現在表示中のテキストをフォームに反映
        nameInput.value = profileNameEl.textContent.trim();
        relationInput.value = profileRelationEl.textContent.trim();
        // <br> を改行に変換
        messageInput.value = profileMessageEl.innerHTML
          .replace(/<br\s*\/?>/gi, "\n")
          .replace(/\n/g, "\n")
          .replace(/
\s*
/g, "\n")
          .replace(/\n/g, "\n");
        messageInput.value = profileMessageEl.innerText.trim();
      }
    }

    toggleProfileFormBtn.addEventListener("click", () => {
      toggleProfileForm();
    });

    cancelProfileEditBtn.addEventListener("click", () => {
      toggleProfileForm(false);
    });

    saveProfileBtn.addEventListener("click", () => {
      const name = nameInput.value.trim();
      const relation = relationInput.value.trim();
      const msg = messageInput.value.trim();

      if (name) {
        profileNameEl.textContent = name;
      }
      if (relation) {
        profileRelationEl.textContent = relation;
      }
      if (msg) {
        profileMessageEl.innerHTML = msg.replace(/\n/g, "<br />");
      }

      toggleProfileForm(false);
    });

    // --- お供え ---
    const offeringsListEl = document.getElementById("offeringsList");
    const categorySelectEl = document.getElementById("categorySelect");
    const brandSelectEl = document.getElementById("brandSelect");
    const customLabelInputEl = document.getElementById("customLabelInput");
    const addOfferingBtn = document.getElementById("addOfferingBtn");

    function formatDateTime(d) {
      const y = d.getFullYear();
      const m = String(d.getMonth() + 1).padStart(2, "0");
      const day = String(d.getDate()).padStart(2, "0");
      const h = String(d.getHours()).padStart(2, "0");
      const min = String(d.getMinutes()).padStart(2, "0");
      return `${y}-${m}-${day} ${h}:${min}`;
    }

    function createOfferingCard({ label, category, brand, isSample }) {
      const card = document.createElement("div");
      card.className = "offering-card";

      const mainEl = document.createElement("div");
      mainEl.className = "offering-main";
      mainEl.textContent = label;

      const brandEl = document.createElement("div");
      brandEl.className = "offering-brand";
      if (brand) {
        brandEl.textContent = brand + (isSample ? "（サンプル）" : "");
      }

      const metaEl = document.createElement("div");
      metaEl.className = "offering-meta";
      const now = new Date();
      metaEl.innerHTML =
        `<span>カテゴリ：${category}</span>` +
        `<span>お供え日時：${formatDateTime(now)}</span>`;

      card.appendChild(mainEl);
      if (brand) card.appendChild(brandEl);
      card.appendChild(metaEl);

      return card;
    }

    function addOfferingFromControls() {
      const category = categorySelectEl.value;
      const brand = brandSelectEl.value;
      const customLabel = customLabelInputEl.value.trim();

      let label;
      if (customLabel) {
        label = customLabel;
      } else {
        switch (category) {
          case "線香":
            label = "お線香（デジタル）";
            break;
          case "花":
            label = "お花（デジタル）";
            break;
          case "甘味":
            label = "お団子セット";
            break;
          case "飲み物":
            label = "ビール";
            break;
          default:
            label = "お供え（デジタル）";
        }
      }
      const isSample = brand.startsWith("企業サンプル");
      const card = createOfferingCard({ label, category, brand, isSample });
      offeringsListEl.prepend(card);
      customLabelInputEl.value = "";
    }

    addOfferingBtn.addEventListener("click", addOfferingFromControls);

    // 初期サンプル
    function initSampleOfferings() {
      const now = new Date();
      const samples = [
        {
          label: "お線香（デジタル）",
          category: "線香",
          brand: "デジタル表示のみ",
          isSample: false,
        },
        {
          label: "季節のお花",
          category: "花",
          brand: "企業サンプル：フラワーショップ",
          isSample: true,
        },
      ];
      samples.forEach((s) => {
        const card = createOfferingCard(s);
        offeringsListEl.appendChild(card);
      });
    }

    initSampleOfferings();
  </script>
</body>
</html>
