<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ãƒ‡ã‚¸ã‚¿ãƒ«ä»å£‡ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ— vA10e</title>
  <style>
    :root { color-scheme: dark; }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", Arial,
        "æ¸¸ã‚´ã‚·ãƒƒã‚¯ä½“", "YuGothic", "ãƒ¡ã‚¤ãƒªã‚ª", sans-serif;
      background: radial-gradient(circle at top, #333 0, #000 55%);
      color: #f5f5f5;
      display: flex;
      justify-content: center;
    }
    .wrapper {
      max-width: 520px;
      width: 100%;
      min-height: 100vh;
      padding: 14px;
    }
    .app-card {
      background: rgba(15,15,15,0.94);
      border-radius: 18px;
      padding: 14px 14px 16px;
      box-shadow: 0 0 25px rgba(0,0,0,0.75);
      border: 1px solid #444;
    }
    .app-header {
      margin-bottom: 8px;
    }
    .app-title-main {
      font-size: 17px;
      font-weight: 600;
    }
    .app-title-sub {
      font-size: 11px;
      color: #ccc;
      margin-top: 2px;
    }

    /* ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«åˆ‡ã‚Šæ›¿ãˆ */
    .profile-switcher {
      margin-top: 8px;
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      align-items: center;
    }
    .profile-switcher-label {
      font-size: 11px;
      color: #bbb;
      margin-right: 2px;
    }
    #profileChipContainer {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      align-items: center;
    }
    .profile-chip {
      border-radius: 999px;
      border: 1px solid #555;
      padding: 4px 10px;
      font-size: 11px;
      background: #111;
      color: #eee;
    }
    .profile-chip.active {
      background: linear-gradient(135deg, #9fd3ff, #3b81ff);
      border-color: #9fd3ff;
      color: #041424;
      font-weight: 600;
    }
    .profile-chip.add {
      border-style: dashed;
      opacity: 0.9;
    }

    .step-nav {
      display: flex;
      gap: 4px;
      margin: 10px 0 10px;
      overflow-x: auto;
    }
    .step-nav button {
      flex: 1;
      min-width: 0;
      border-radius: 999px;
      border: 1px solid #555;
      padding: 6px 8px;
      font-size: 11px;
      background: #111;
      color: #eee;
      white-space: nowrap;
    }
    .step-nav button.active {
      background: linear-gradient(135deg, #f5d27a, #b58b2a);
      border-color: #f5d27a;
      color: #16130a;
      font-weight: 600;
    }

    .divider {
      height: 1px;
      margin: 8px 0 10px;
      background: linear-gradient(to right, transparent, #777, transparent);
    }

    .section-title {
      font-size: 13px;
      letter-spacing: 0.08em;
      color: #bbb;
      text-transform: uppercase;
      margin-bottom: 6px;
    }

    .tab-panel { display: none; }
    .tab-panel.active { display: block; }

    /* éºå½±ã‚¿ãƒ– */
    .portrait-area {
      display: flex;
      gap: 10px;
      align-items: center;
    }
    .portrait-frame {
      flex: 0 0 110px;
      padding: 6px;
      border-radius: 12px;
      border: 3px solid #f5f5f5;
      background: linear-gradient(135deg, #444, #111);
    }
    .portrait {
      height: 128px;
      border-radius: 8px;
      background: #555;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      color: #eee;
      text-align: center;
      padding: 4px;
    }
    .portrait-status-pill {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      border-radius: 999px;
      padding: 3px 9px;
      font-size: 11px;
      margin-bottom: 4px;
    }
    .portrait-status-pill span { font-weight: 600; }
    .portrait-status-pill.status-unsubmitted {
      background: rgba(120,120,120,0.15);
      border: 1px solid #666;
      color: #ddd;
    }
    .portrait-status-pill.status-review {
      background: rgba(255,196,87,0.12);
      border: 1px solid #f5d27a;
      color: #f5d27a;
    }
    .portrait-status-pill.status-approved {
      background: rgba(126,217,109,0.15);
      border: 1px solid #7ed96d;
      color: #caffb8;
    }
    .portrait-text {
      font-size: 12px;
      color: #e0e0e0;
      line-height: 1.5;
    }
    .portrait-buttons {
      margin-top: 6px;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }
    .btn {
      border-radius: 999px;
      padding: 6px 12px;
      font-size: 11px;
      border: 1px solid #666;
      background: #171717;
      color: #f8f8f8;
    }
    .btn-primary {
      border-color: #f5d27a;
      background: linear-gradient(135deg, #f5d27a, #b58b2a);
      color: #16130a;
      font-weight: 600;
    }
    .btn-ghost { background: transparent; }
    .btn:active { opacity: 0.85; }
    .btn-small {
      padding: 4px 9px;
      font-size: 11px;
    }
    .note {
      font-size: 10px;
      color: #999;
      margin-top: 6px;
      line-height: 1.5;
    }

    /* ä»å£‡ã‚¿ãƒ– */
    .altar-layout { display: flex; flex-direction: column; gap: 10px; }

    .altar-preview {
      border-radius: 14px;
      padding: 10px;
      border: 1px solid #555;
      background: radial-gradient(circle at top, #3a2a18 0, #120e0a 55%);
      min-height: 150px;
      position: relative;
      overflow: hidden;
    }
    .altar-preview.alt-basic {
      background: radial-gradient(circle at top, #3a2a18 0, #120e0a 55%);
    }
    .altar-preview.alt-gold {
      background: radial-gradient(circle at top, #614000 0, #1b1205 55%);
    }
    .altar-preview.alt-modern {
      background: radial-gradient(circle at top, #3c4148 0, #0b0d10 55%);
    }
    .altar-shelf {
      position: absolute;
      left: 6%; right: 6%; bottom: 18%; height: 32%;
      border-radius: 10px 10px 4px 4px;
      background: linear-gradient(to bottom, rgba(0,0,0,0.2), rgba(0,0,0,0.7));
      border-top: 1px solid rgba(255,255,255,0.2);
    }
    .altar-base {
      position: absolute;
      left: 0; right: 0; bottom: 9%; height: 16%;
      background: linear-gradient(to bottom, rgba(0,0,0,0.1), rgba(0,0,0,0.9));
    }
    .altar-portrait-small {
      position: absolute;
      top: 16%; left: 50%;
      transform: translateX(-50%);
      width: 80px; height: 95px;
      border-radius: 9px;
      background: rgba(120,120,120,0.6);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      text-align: center;
      padding: 3px;
      border: 2px solid rgba(245,245,245,0.7);
    }
    .altar-portrait-small.approved {
      background: rgba(230,230,230,0.95);
      color: #222;
    }
    .altar-label {
      position: absolute;
      top: 6%; left: 10px;
      font-size: 11px;
      color: #f5e3c0;
      text-shadow: 0 0 4px rgba(0,0,0,0.6);
    }
    .altar-status {
      position: absolute;
      top: 6%; right: 10px;
      font-size: 11px;
      color: #eee;
      background: rgba(0,0,0,0.45);
      padding: 2px 7px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.15);
    }
    .altar-items-row {
      position: absolute;
      bottom: 22%; left: 8%; right: 8%;
      display: flex;
      justify-content: center;
      gap: 12px;
      font-size: 11px;
    }
    .altar-item-pill {
      padding: 2px 7px;
      border-radius: 999px;
      background: rgba(0,0,0,0.5);
      border: 1px solid rgba(255,255,255,0.18);
    }

    /* é¦™ç‚‰ãƒ»ç·šé¦™ãƒ»ç…™ */
    .incense-area {
      position: absolute;
      bottom: 20%;
      left: 50%;
      transform: translateX(-50%);
      width: 40px;
      height: 40px;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    .incense-area.active {
      opacity: 1;
    }
    .incense-burner {
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 40px;
      height: 12px;
      border-radius: 8px;
      background: radial-gradient(circle at top, #555 0, #222 60%);
      box-shadow: 0 0 6px rgba(0,0,0,0.7);
      border: 1px solid rgba(255,255,255,0.2);
    }
    .incense-stick {
      position: absolute;
      bottom: 10px;
      left: 50%;
      width: 3px;
      height: 16px;
      transform: translateX(-50%);
      background: linear-gradient(to top, #4a2a1a, #d7c08a);
      border-radius: 2px;
    }
    .incense-smoke {
      position: absolute;
      bottom: 26px;
      left: 50%;
      width: 6px;
      height: 16px;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(255,255,255,0.9) 0, rgba(255,255,255,0) 70%);
      opacity: 0;
      transform: translateX(-50%);
      animation: smokeRise 2.6s linear infinite;
    }
    .incense-smoke.smoke-2 {
      animation-delay: 0.9s;
    }
    .incense-smoke.smoke-3 {
      animation-delay: 1.8s;
    }
    @keyframes smokeRise {
      0% {
        opacity: 0;
        transform: translate(-50%, 0) scale(0.6);
      }
      30% {
        opacity: 0.8;
        transform: translate(-50%, -6px) scale(0.9);
      }
      70% {
        opacity: 0.4;
        transform: translate(-50%, -14px) scale(1.1);
      }
      100% {
        opacity: 0;
        transform: translate(-50%, -22px) scale(1.2);
      }
    }

    .altar-controls {
      border-radius: 12px;
      border: 1px solid #333;
      background: #151515;
      padding: 8px;
      font-size: 12px;
    }
    .form-row {
      display: flex;
      gap: 6px;
      margin-bottom: 6px;
      flex-wrap: wrap;
    }
    .form-row label {
      font-size: 11px;
      color: #ccc;
    }
    select,
    input[type="text"],
    textarea {
      border-radius: 999px;
      border: 1px solid #555;
      background: #101010;
      color: #f5f5f5;
      font-size: 12px;
      padding: 6px 9px;
      flex: 1;
      min-width: 0;
    }
    textarea {
      border-radius: 10px;
      resize: vertical;
      min-height: 48px;
    }

    .catalog-list {
      display: flex;
      gap: 6px;
      overflow-x: auto;
      margin-top: 4px;
      padding-bottom: 2px;
    }
    .catalog-card {
      flex: 0 0 150px;
      border-radius: 10px;
      border: 1px solid #444;
      padding: 6px;
      background: #1b1b1b;
      font-size: 11px;
    }
    .catalog-name { font-weight: 600; margin-bottom: 2px; }
    .catalog-meta { font-size: 10px; color: #b5b5b5; margin-bottom: 4px; }

    /* éˆ´ãƒ»ç·šé¦™æ“ä½œ */
    .ritual-controls {
      margin-top: 6px;
      padding: 8px;
      border-radius: 12px;
      border: 1px solid #333;
      background: #141414;
      font-size: 11px;
    }
    .ritual-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 6px;
      align-items: center;
    }
    .ritual-label {
      font-size: 11px;
      color: #ccc;
      min-width: 70px;
    }
    .ritual-status-text {
      font-size: 11px;
      color: #f5d27a;
    }

    /* ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚¿ãƒ– */
    .profile-summary {
      margin-bottom: 8px;
      padding: 8px;
      border-radius: 12px;
      border: 1px solid #333;
      background: #171717;
      font-size: 12px;
      line-height: 1.6;
    }
    .profile-summary-title {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 2px;
    }
    .profile-summary-sub {
      font-size: 11px;
      color: #bbb;
    }
    .profile-form-grid {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-top: 4px;
    }
    .profile-form-grid label {
      font-size: 11px;
      color: #ccc;
      display: block;
      margin-bottom: 2px;
    }
    .profile-save-row {
      margin-top: 6px;
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      align-items: center;
    }
    .save-status {
      font-size: 10px;
      color: #9fd69f;
    }

    /* éŸ³å£°ã‚¿ãƒ– */
    .audio-grid {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .audio-card {
      border-radius: 10px;
      border: 1px solid #333;
      background: #171717;
      padding: 8px;
      font-size: 12px;
    }
    .audio-phrase { font-weight: 600; margin-bottom: 2px; }
    .audio-note { font-size: 11px; color: #aaa; margin-top: 4px; }

    .footer {
      margin-top: 10px;
      font-size: 11px;
      color: #888;
      text-align: center;
      line-height: 1.6;
    }
    .badge {
      display: inline-block;
      font-size: 10px;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid #666;
      margin-top: 4px;
    }
  </style>
</head>
<body>
  <div class="wrapper">
    <div class="app-card">
      <div class="app-header">
        <div class="app-title-main">ãƒ‡ã‚¸ã‚¿ãƒ«ä»å£‡ã‚¢ãƒ—ãƒªãƒ»ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—</div>
        <div class="app-title-sub">
          â‘ éºå½± â†’ â‘¡ä»å£‡ â†’ â‘¢ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ« â†’ â‘£éŸ³å£°ã‚¤ãƒ¡ãƒ¼ã‚¸ã¾ã§ã‚’ä¸€ç”»é¢ã«ã¾ã¨ã‚ãŸè¨­è¨ˆç‰ˆï¼ˆHTMLãƒ‡ãƒ¢ï¼‰
        </div>
        <div class="profile-switcher">
          <span class="profile-switcher-label">ã”ä¾›é¤Šã™ã‚‹æ–¹ï¼š</span>
          <div id="profileChipContainer"></div>
        </div>
      </div>

      <div class="step-nav">
        <button class="active" data-tab="portrait">â‘  éºå½±</button>
        <button data-tab="altar">â‘¡ ä»å£‡</button>
        <button data-tab="profile">â‘¢ ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</button>
        <button data-tab="audio">â‘£ éŸ³å£°ï¼ˆå°†æ¥æ¡ˆï¼‰</button>
      </div>

      <div class="divider"></div>

      <!-- éºå½±ã‚¿ãƒ– -->
      <section id="tab-portrait" class="tab-panel active">
        <div class="section-title">Portrait</div>
        <div class="portrait-area">
          <div class="portrait-frame">
            <div id="portraitDisplay" class="portrait">
              éºå½±ï¼ˆã‚µãƒ³ãƒ—ãƒ«ï¼‰<br />ã‚¿ãƒƒãƒ—ã§å¤‰æ›´ã¯<br />ã‚¢ãƒ—ãƒªç‰ˆã§å®Ÿè£…äºˆå®š
            </div>
          </div>
          <div style="flex:1;">
            <div id="portraitStatusPill" class="portrait-status-pill status-unsubmitted">
              <span>æœªç”³è«‹</span>ï¼ˆã‚µãƒ³ãƒ—ãƒ«ï¼‰
            </div>
            <div class="portrait-text" id="portraitStatusText">
              ã¾ã éºå½±ã®ç”³è«‹ã¯è¡Œã‚ã‚Œã¦ã„ã¾ã›ã‚“ã€‚<br />
              å®Ÿéš›ã®ã‚¢ãƒ—ãƒªã§ã¯ã€é‹å–¶ã«éºå½±å†™çœŸã‚’æå‡º â†’ ã‚¹ã‚¿ãƒƒãƒ•ãŒç¢ºèªã—ã¦æ‰¿èªã—ã¾ã™ã€‚
            </div>
            <div class="portrait-buttons">
              <button id="btnRequestPortrait" class="btn-primary" type="button">
                éºå½±ã‚’ç”³è«‹ã—ãŸã“ã¨ã«ã™ã‚‹ï¼ˆãƒ‡ãƒ¢ï¼‰
              </button>
              <button id="btnApprovePortrait" class="btn btn-ghost" type="button">
                å¯©æŸ»ã§ã€Œæ‰¿èªã€ã«ãªã£ãŸã“ã¨ã«ã™ã‚‹ï¼ˆãƒ‡ãƒ¢ï¼‰
              </button>
            </div>
            <div class="note">
              â€»ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã”ã¨ï¼ˆç¥–çˆ¶ãƒ»ç¥–æ¯ãƒ»ãƒšãƒƒãƒˆãƒ»è¿½åŠ ã—ãŸæ–¹ï¼‰ã«ã€ç”³è«‹çŠ¶æ³ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‰ã‚Œã¾ã™ã€‚<br />
              å®Ÿéš›ã®ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ»å¯©æŸ»ã¯ã‚¢ãƒ—ãƒªå´ã§å®Ÿè£…äºˆå®šã§ã™ã€‚
            </div>
          </div>
        </div>
      </section>

      <!-- ä»å£‡ã‚¿ãƒ– -->
      <section id="tab-altar" class="tab-panel">
        <div class="section-title">Altar</div>
        <div class="altar-layout">
          <div class="altar-preview alt-basic" id="altarPreview">
            <div class="altar-label" id="altarLabel">ã‚·ãƒ³ãƒ—ãƒ«ãªä»å£‡ï¼ˆã‚µãƒ³ãƒ—ãƒ«ï¼‰</div>
            <div class="altar-status" id="altarPortraitStatus">éºå½±ï¼šæœªæ‰¿èª</div>
            <div class="altar-portrait-small" id="altarPortraitSmall">
              éºå½±ç¢ºèªä¸­
            </div>
            <div class="altar-items-row" id="altarItemsRow">
              <div class="altar-item-pill">ğŸ•¯ ãŠç·šé¦™</div>
              <div class="altar-item-pill">ğŸ’ ãŠèŠ±</div>
            </div>
            <div class="incense-area" id="incenseArea">
              <div class="incense-burner"></div>
              <div class="incense-stick"></div>
              <div class="incense-smoke smoke-1"></div>
              <div class="incense-smoke smoke-2"></div>
              <div class="incense-smoke smoke-3"></div>
            </div>
            <div class="altar-shelf"></div>
            <div class="altar-base"></div>
          </div>

          <div class="altar-controls">
            <div class="form-row">
              <label for="altarStyleSelect">ä»å£‡ã®ã‚¿ã‚¤ãƒ—</label>
              <select id="altarStyleSelect">
                <option value="basic">ã‚·ãƒ³ãƒ—ãƒ«ä»å£‡ï¼ˆæ¨™æº–ï¼‰</option>
                <option value="gold">é‡‘ä»å£‡ï¼ˆè˜å³ï¼‰</option>
                <option value="modern">ãƒ¢ãƒ€ãƒ³ä»å£‡ï¼ˆãƒªãƒ“ãƒ³ã‚°å‘ã‘ï¼‰</option>
              </select>
            </div>
            <div class="form-row">
              <label for="altarItemsInput">ãŠä¾›ãˆã™ã‚‹ã‚‚ã®ï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰</label>
              <input
                id="altarItemsInput"
                type="text"
                placeholder="ä¾‹ï¼‰ãŠç·šé¦™, ãŠèŠ±, ã„ã¡ã”å¤§ç¦"
              />
            </div>
            <div class="form-row" style="justify-content:flex-end;">
              <button id="btnApplyAltar" type="button" class="btn btn-primary">
                ä»å£‡ã«åæ˜ ã™ã‚‹ï¼ˆã“ã®æ–¹ã®è¨­å®šï¼‰
              </button>
            </div>
            <div class="note">
              â€»å®Ÿéš›ã®ã‚¢ãƒ—ãƒªã§ã¯ã€ã“ã“ã‹ã‚‰ã€Œä»å£‡ã‚«ã‚¿ãƒ­ã‚°ã€ã‚„<br />
              ã€Œä½ç‰Œã®æ–‡å­—å…¥åŠ›ã€ç”»é¢ã«é·ç§»ã™ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã™ã€‚
            </div>
            <div style="margin-top:6px;">
              <div style="font-size:11px;color:#bbb;margin-bottom:2px;">ä»å£‡ã‚«ã‚¿ãƒ­ã‚°ï¼ˆã‚µãƒ³ãƒ—ãƒ«ï¼‰</div>
              <div class="catalog-list">
                <div class="catalog-card" data-style="basic">
                  <div class="catalog-name">ã‚·ãƒ³ãƒ—ãƒ«ä»å£‡</div>
                  <div class="catalog-meta">æœ¨ç›®èª¿ãƒ»çœã‚¹ãƒšãƒ¼ã‚¹ãƒ»ä¸€äººæš®ã‚‰ã—ã«ã‚‚</div>
                  <button type="button" class="btn btn-ghost btn-catalog-choose">
                    ã“ã‚Œã‚’é¸ã¶
                  </button>
                </div>
                <div class="catalog-card" data-style="gold">
                  <div class="catalog-name">é‡‘ä»å£‡</div>
                  <div class="catalog-meta">ä¼çµ±çš„ãƒ»ã”æœ¬å°Šã¨ä½ç‰Œã‚’ç¥€ã‚‹æœ¬æ ¼ã‚¿ã‚¤ãƒ—</div>
                  <button type="button" class="btn btn-ghost btn-catalog-choose">
                    ã“ã‚Œã‚’é¸ã¶
                  </button>
                </div>
                <div class="catalog-card" data-style="modern">
                  <div class="catalog-name">ãƒ¢ãƒ€ãƒ³ä»å£‡</div>
                  <div class="catalog-meta">ãƒªãƒ“ãƒ³ã‚°ã«é¦´æŸ“ã‚€ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ»æ‰‰ä»˜ã</div>
                  <button type="button" class="btn btn-ghost btn-catalog-choose">
                    ã“ã‚Œã‚’é¸ã¶
                  </button>
                </div>
              </div>
            </div>
          </div>

          <div class="ritual-controls">
            <div class="ritual-row">
              <span class="ritual-label">éˆ´ï¼š</span>
              <button id="btnRingBell" type="button" class="btn btn-small">
                éˆ´ã‚’é³´ã‚‰ã™ï¼ˆãƒãƒ¼ãƒ³ï¼‰
              </button>
              <span id="bellStatus" class="ritual-status-text"></span>
            </div>
            <div class="ritual-row">
              <span class="ritual-label">ç·šé¦™ï¼š</span>
              <button type="button" class="btn btn-small" data-incense="15">15ç§’</button>
              <button type="button" class="btn btn-small" data-incense="30">30ç§’</button>
              <button type="button" class="btn btn-small" data-incense="60">1åˆ†</button>
              <span id="incenseStatus" class="ritual-status-text"></span>
            </div>
            <div class="note">
              â€»ã“ã®ãƒ‡ãƒ¢ã§ã¯ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ã¨é¦™ç‚‰ã®ç…™ã®è¡¨ç¤ºã®ã¿è¡Œã„ã¾ã™ã€‚<br />
              å°†æ¥ã®ã‚¢ãƒ—ãƒªç‰ˆã§ã¯ã€ã‚ˆã‚Šæœ¬æ ¼çš„ãªéŸ³ã‚„ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚‚æ¤œè¨ã§ãã¾ã™ã€‚
            </div>
          </div>
        </div>
      </section>

      <!-- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚¿ãƒ– -->
      <section id="tab-profile" class="tab-panel">
        <div class="section-title">Profile</div>
        <div class="profile-summary" id="profileSummary">
          <div class="profile-summary-title" id="summaryName">å±±ç”° å¤ªéƒ ã•ã‚“</div>
          <div class="profile-summary-sub" id="summaryRelation">
            ã‚ãªãŸã®ãŠã˜ã„ã¡ã‚ƒã‚“ï¼ˆçˆ¶æ–¹ï¼‰
          </div>
          <div style="margin-top:4px;" id="summaryDetail">
            æ²¡å¹´æœˆæ—¥ï¼š----å¹´--æœˆ--æ—¥ï¼ˆæœªè¨­å®šï¼‰<br />
            æˆ’åï¼šæœªè¨­å®š<br />
            ä¸€è¨€ãƒ¡ãƒ¢ï¼šã„ã¤ã‚‚è¦‹å®ˆã£ã¦ãã‚Œã¦ã‚ã‚ŠãŒã¨ã†ã€‚ç„¡ç†ã—ã™ããšã€å…ƒæ°—ã§éã”ã™ã‚“ã ã‚ˆã€‚
          </div>
        </div>

        <div class="note">
          å…¥åŠ›ã—ãŸå†…å®¹ã¯ã€ã“ã®ç«¯æœ«ã®ãƒ–ãƒ©ã‚¦ã‚¶å†…ï¼ˆlocalStorageï¼‰ã«ã®ã¿ä¿å­˜ã•ã‚Œã¾ã™ã€‚<br />
          ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã”ã¨ï¼ˆç¥–çˆ¶ãƒ»ç¥–æ¯ãƒ»ãƒšãƒƒãƒˆãƒ»è¿½åŠ ã—ãŸæ–¹ï¼‰ã«åˆ¥ã€…ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚
        </div>

        <div class="profile-form-grid">
          <div>
            <label for="profileNameInput">ãŠåå‰</label>
            <input id="profileNameInput" type="text" placeholder="ä¾‹ï¼‰å±±ç”° å¤ªéƒ ã•ã‚“" />
          </div>
          <div>
            <label for="profileRelationInput">ã‚ãªãŸã¨ã®é–¢ä¿‚</label>
            <input id="profileRelationInput" type="text" placeholder="ä¾‹ï¼‰ã‚ãªãŸã®ãŠã˜ã„ã¡ã‚ƒã‚“ï¼ˆçˆ¶æ–¹ï¼‰" />
          </div>
          <div>
            <label for="profileDeathDateInput">æ²¡å¹´æœˆæ—¥</label>
            <input id="profileDeathDateInput" type="date" />
          </div>
          <div>
            <label for="profileKaimyoInput">æˆ’åï¼ˆã‚ã‚Œã°ï¼‰</label>
            <input id="profileKaimyoInput" type="text" placeholder="ä¾‹ï¼‰â—‹â—‹é™¢â–³â–³å±…å£«" />
          </div>
          <div>
            <label for="profileMemoInput">æ€ã„å‡ºãƒ¡ãƒ¢ãƒ»ä¸€è¨€</label>
            <textarea id="profileMemoInput" placeholder="ä¾‹ï¼‰ä¸€ç·’ã«é‡£ã‚Šã«è¡Œã£ãŸå¤ã®ã“ã¨ã¯ä¸€ç”Ÿå¿˜ã‚Œã¾ã›ã‚“ã€‚"></textarea>
          </div>
        </div>

        <div class="profile-save-row">
          <span class="save-status" id="profileSaveStatus"></span>
          <button id="btnResetProfile" type="button" class="btn btn-ghost">
            å…¥åŠ›ã‚’ãƒªã‚»ãƒƒãƒˆ
          </button>
          <button id="btnSaveProfile" type="button" class="btn btn-primary">
            ã“ã®ç«¯æœ«ã«ä¿å­˜ã—ã¦åæ˜ ï¼ˆã“ã®æ–¹ï¼‰
          </button>
        </div>
      </section>

      <!-- éŸ³å£°ã‚¿ãƒ– -->
      <section id="tab-audio" class="tab-panel">
        <div class="section-title">Audio (Plan)</div>
        <div class="audio-grid">
          <div class="audio-card">
            <div class="audio-phrase">ã€Œã„ã¤ã‚‚ã‚ã‚ŠãŒã¨ã†ã€‚ã€</div>
            <div class="audio-note">
              å°†æ¥ã®ã‚¢ãƒ—ãƒªç‰ˆã§ã¯ã€ã“ã“ã«æ•…äººã®å£°ã‚’å†ç¾ã—ãŸéŸ³å£°ãƒœã‚¿ãƒ³ãŒä¸¦ã³ã¾ã™ã€‚<br />
              äº‹å‰ã«ã”å®¶æ—ãŒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ãŸéŸ³å£°ã‚’ã‚‚ã¨ã«ã€Œã‚ã‚ŠãŒã¨ã†ã€ã€Œå…ƒæ°—ã«ã—ã¦ã„ã‚‹ã‹ã„ï¼Ÿã€ãªã©ã€
              ã‚·ãƒ¼ãƒ³ã«åˆã‚ã›ãŸã²ã¨è¨€ã‚’å†ç”Ÿã§ãã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã™ã€‚
            </div>
          </div>
          <div class="audio-card">
            <div class="audio-phrase">ã€ŒãŸã¾ã«ã¯ãŠå¢“å‚ã‚Šã«ã‚‚æ¥ã¦ã­ã€‚ã€</div>
            <div class="audio-note">
              å£°ã®å†ç¾ã¯ã€åŒæ„ã‚’å¾—ãŸæ–¹ã®ã¿ãƒ»å®‰å…¨ã«é…æ…®ã—ãŸç¯„å›²ã§å®Ÿè£…äºˆå®šã§ã™ã€‚<br />
              ã“ã®HTMLãƒ‡ãƒ¢ã§ã¯å®Ÿéš›ã®éŸ³å£°å†ç”Ÿã¯è¡Œã‚ãšã€ã€Œå°†æ¥ã®è¨­è¨ˆæ¡ˆã€ã¨ã—ã¦ã®è¡¨ç¤ºã®ã¿ã§ã™ã€‚
            </div>
          </div>
        </div>
      </section>

      <div class="divider"></div>

      <div class="footer">
        ãƒ‡ã‚¸ã‚¿ãƒ«ä»å£‡ã‚¢ãƒ—ãƒª ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ— v11.1.1 / vA10eï¼ˆHTMLãƒ‡ãƒ¢ï¼‰<br />
        ãƒ»â‘ éºå½±ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ â†’ â‘¡ä»å£‡ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼é€£å‹•ï¼ˆãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«åˆ¥ï¼‰<br />
        ãƒ»â‘¢ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã¯ localStorage ã«ä¿å­˜ï¼ˆç¥–çˆ¶ãƒ»ç¥–æ¯ãƒ»ãƒšãƒƒãƒˆï¼‹è¿½åŠ åˆ†ï¼‰<br />
        ãƒ»éˆ´ãƒœã‚¿ãƒ³ï¼ç·šé¦™ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ï¼‹é¦™ç‚‰ã®ç…™ã¤ãï¼ˆ15ç§’ãƒ»30ç§’ãƒ»1åˆ†ï¼‰<br />
        <span class="badge">ãƒ†ã‚¹ãƒˆç”¨ / å®Ÿã‚µãƒ¼ãƒ“ã‚¹ã¨ã¯ç•°ãªã‚Šã¾ã™</span>
      </div>
    </div>
  </div>

  <script>
    // ==== ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç† ====
    const profileChipContainer = document.getElementById("profileChipContainer");
    const PROFILE_LIST_KEY = "digital_altar_profile_list_vA10e";
    let currentProfileId = "grandfather"; // default
    let profileList = [];

    function safeLoad(key, fallback = null) {
      try {
        const raw = localStorage.getItem(key);
        if (!raw) return fallback;
        return JSON.parse(raw);
      } catch (e) {
        return fallback;
      }
    }
    function safeSave(key, value) {
      try {
        localStorage.setItem(key, JSON.stringify(value));
      } catch (e) {}
    }

    function loadProfileList() {
      const saved = safeLoad(PROFILE_LIST_KEY, null);
      if (saved && Array.isArray(saved) && saved.length > 0) {
        profileList = saved;
      } else {
        profileList = [
          { id: "grandfather", label: "ç¥–çˆ¶" },
          { id: "grandmother", label: "ç¥–æ¯" },
          { id: "pet", label: "ãƒšãƒƒãƒˆ" },
        ];
      }
      // currentProfileId ãŒãƒªã‚¹ãƒˆã«ãªã„å ´åˆã€å…ˆé ­ã«åˆã‚ã›ã‚‹
      if (!profileList.some(p => p.id === currentProfileId)) {
        currentProfileId = profileList[0]?.id || "grandfather";
      }
    }

    function saveProfileList() {
      safeSave(PROFILE_LIST_KEY, profileList);
    }

    function renderProfileChips() {
      profileChipContainer.innerHTML = "";
      profileList.forEach((p) => {
        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = "profile-chip" + (p.id === currentProfileId ? " active" : "");
        btn.textContent = p.label;
        btn.dataset.profileId = p.id;
        btn.addEventListener("click", () => {
          if (p.id !== currentProfileId) {
            switchProfile(p.id);
          }
        });
        profileChipContainer.appendChild(btn);
      });
      // è¿½åŠ ãƒœã‚¿ãƒ³
      const addBtn = document.createElement("button");
      addBtn.type = "button";
      addBtn.className = "profile-chip add";
      addBtn.textContent = "+ è¿½åŠ ";
      addBtn.addEventListener("click", () => {
        const label = window.prompt("è¿½åŠ ã™ã‚‹æ–¹ã®å‘¼ã³åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä¾‹ï¼šçˆ¶ã€æ¯ã€å…„ã€æ¨ã— ãªã©ï¼‰");
        if (!label) return;
        const id = "p_" + Date.now().toString(36);
        profileList.push({ id, label: label.trim() });
        saveProfileList();
        currentProfileId = id;
        renderProfileChips();
        switchProfile(id);
      });
      profileChipContainer.appendChild(addBtn);
    }

    function getStorageKey(base) {
      return base + "_" + currentProfileId;
    }

    // ==== localStorage ãƒ™ãƒ¼ã‚¹ ====
    const STORAGE_PROFILE_BASE = "digital_altar_profile_vA10e";
    const STORAGE_PORTRAIT_BASE = "digital_altar_portrait_status_vA10e";
    const STORAGE_ALTAR_BASE   = "digital_altar_altar_vA10e";

    // ==== ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ ====
    const tabButtons = document.querySelectorAll(".step-nav button");
    const tabPanels = {
      portrait: document.getElementById("tab-portrait"),
      altar: document.getElementById("tab-altar"),
      profile: document.getElementById("tab-profile"),
      audio: document.getElementById("tab-audio"),
    };
    tabButtons.forEach((btn) => {
      btn.addEventListener("click", () => {
        const tab = btn.getAttribute("data-tab");
        tabButtons.forEach((b) => b.classList.remove("active"));
        btn.classList.add("active");
        Object.keys(tabPanels).forEach((key) => {
          tabPanels[key].classList.toggle("active", key === tab);
        });
      });
    });

    // ==== éºå½±ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ ====
    const portraitStatusPill = document.getElementById("portraitStatusPill");
    const portraitStatusText = document.getElementById("portraitStatusText");
    const btnRequestPortrait = document.getElementById("btnRequestPortrait");
    const btnApprovePortrait = document.getElementById("btnApprovePortrait");
    const altarPortraitStatusEl = document.getElementById("altarPortraitStatus");
    const altarPortraitSmallEl = document.getElementById("altarPortraitSmall");

    const PORTRAIT_STATUS = {
      UNSUBMITTED: "unsubmitted",
      REVIEW: "review",
      APPROVED: "approved",
    };

    function updatePortraitUI(status) {
      portraitStatusPill.classList.remove(
        "status-unsubmitted",
        "status-review",
        "status-approved"
      );
      let label = "";
      let text = "";
      if (status === PORTRAIT_STATUS.REVIEW) {
        portraitStatusPill.classList.add("status-review");
        label = "å¯©æŸ»ä¸­";
        text =
          "é‹å–¶ã«éºå½±ã®ç”³è«‹ãŒé€ä¿¡ã•ã‚Œã€ã‚¹ã‚¿ãƒƒãƒ•ãŒç¢ºèªã—ã¦ã„ã‚‹çŠ¶æ…‹ã§ã™ã€‚\nå®Ÿéš›ã®ã‚¢ãƒ—ãƒªã§ã¯ã€å¯©æŸ»ãŒå®Œäº†ã™ã‚‹ã¨è‡ªå‹•ã§ã€Œæ‰¿èªã€ã«åˆ‡ã‚Šæ›¿ã‚ã‚Šã¾ã™ã€‚";
        altarPortraitStatusEl.textContent = "éºå½±ï¼šå¯©æŸ»ä¸­";
        altarPortraitSmallEl.textContent = "å¯©æŸ»ä¸­";
        altarPortraitSmallEl.classList.remove("approved");
      } else if (status === PORTRAIT_STATUS.APPROVED) {
        portraitStatusPill.classList.add("status-approved");
        label = "æ‰¿èªæ¸ˆ";
        text =
          "éºå½±ã®å¯©æŸ»ãŒå®Œäº†ã—ã€æ‰¿èªã•ã‚ŒãŸçŠ¶æ…‹ã§ã™ã€‚\nä»å£‡ã‚¿ãƒ–ã®éºå½±ã«ã‚‚åæ˜ ã•ã‚Œã€è¡¨ç¤ºãŒæ˜ã‚‹ããªã‚Šã¾ã™ã€‚";
        altarPortraitStatusEl.textContent = "éºå½±ï¼šæ‰¿èªæ¸ˆ";
        const profile = safeLoad(getStorageKey(STORAGE_PROFILE_BASE), {});
        const name = profile.name || defaultNameForProfile();
        altarPortraitSmallEl.textContent = name;
        altarPortraitSmallEl.classList.add("approved");
      } else {
        portraitStatusPill.classList.add("status-unsubmitted");
        label = "æœªç”³è«‹";
        text =
          "ã¾ã éºå½±ã®ç”³è«‹ã¯è¡Œã‚ã‚Œã¦ã„ã¾ã›ã‚“ã€‚\nå®Ÿéš›ã®ã‚¢ãƒ—ãƒªã§ã¯ã€ã“ã“ã‹ã‚‰å†™çœŸã‚’é€ä¿¡ã—ã¦å¯©æŸ»ã‚’ä¾é ¼ã—ã¾ã™ã€‚";
        altarPortraitStatusEl.textContent = "éºå½±ï¼šæœªæ‰¿èª";
        altarPortraitSmallEl.textContent = "éºå½±ç¢ºèªä¸­";
        altarPortraitSmallEl.classList.remove("approved");
      }
      portraitStatusPill.querySelector("span").textContent = label;
      portraitStatusText.innerHTML = text.replace(/\n/g, "<br />");
      safeSave(getStorageKey(STORAGE_PORTRAIT_BASE), { status });
    }

    btnRequestPortrait.addEventListener("click", () => {
      updatePortraitUI(PORTRAIT_STATUS.REVIEW);
    });
    btnApprovePortrait.addEventListener("click", () => {
      updatePortraitUI(PORTRAIT_STATUS.APPROVED);
    });

    // ==== ä»å£‡ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ ====
    const altarPreviewEl = document.getElementById("altarPreview");
    const altarLabelEl = document.getElementById("altarLabel");
    const altarItemsInputEl = document.getElementById("altarItemsInput");
    const altarItemsRowEl = document.getElementById("altarItemsRow");
    const altarStyleSelectEl = document.getElementById("altarStyleSelect");
    const btnApplyAltar = document.getElementById("btnApplyAltar");
    const incenseAreaEl = document.getElementById("incenseArea");

    function applyAltarStyle(style) {
      altarPreviewEl.classList.remove("alt-basic","alt-gold","alt-modern");
      let label = "";
      if (style === "gold") {
        altarPreviewEl.classList.add("alt-gold");
        label = "é‡‘ä»å£‡ï¼ˆã‚µãƒ³ãƒ—ãƒ«ï¼‰";
      } else if (style === "modern") {
        altarPreviewEl.classList.add("alt-modern");
        label = "ãƒ¢ãƒ€ãƒ³ä»å£‡ï¼ˆã‚µãƒ³ãƒ—ãƒ«ï¼‰";
      } else {
        altarPreviewEl.classList.add("alt-basic");
        label = "ã‚·ãƒ³ãƒ—ãƒ«ãªä»å£‡ï¼ˆã‚µãƒ³ãƒ—ãƒ«ï¼‰";
      }
      altarLabelEl.textContent = label;
    }

    function applyAltarItems(text) {
      altarItemsRowEl.innerHTML = "";
      const base = text || "ãŠç·šé¦™, ãŠèŠ±";
      const parts = base.split(",").map(s=>s.trim()).filter(Boolean);
      parts.forEach((p) => {
        const pill = document.createElement("div");
        pill.className = "altar-item-pill";
        pill.textContent = p;
        altarItemsRowEl.appendChild(pill);
      });
    }

    btnApplyAltar.addEventListener("click", () => {
      const style = altarStyleSelectEl.value;
      const items = altarItemsInputEl.value;
      applyAltarStyle(style);
      applyAltarItems(items);
      safeSave(getStorageKey(STORAGE_ALTAR_BASE), { style, items });
    });

    document.querySelectorAll(".btn-catalog-choose").forEach((btn) => {
      btn.addEventListener("click", () => {
        const card = btn.closest(".catalog-card");
        if (!card) return;
        const style = card.getAttribute("data-style") || "basic";
        altarStyleSelectEl.value = style;
        applyAltarStyle(style);
        safeSave(getStorageKey(STORAGE_ALTAR_BASE), {
          style,
          items: altarItemsInputEl.value,
        });
      });
    });

    // ==== éˆ´ãƒ»ç·šé¦™ ====
    const btnRingBell = document.getElementById("btnRingBell");
    const bellStatus = document.getElementById("bellStatus");
    const incenseButtons = document.querySelectorAll("button[data-incense]");
    const incenseStatus = document.getElementById("incenseStatus");
    let incenseTimerId = null;
    let incenseRemaining = 0;

    let audioCtx = null;
    function ringBellSound() {
      try {
        if (!audioCtx) {
          window.AudioContext = window.AudioContext || window.webkitAudioContext;
          if (!window.AudioContext) return;
          audioCtx = new AudioContext();
        }
        const ctx = audioCtx;
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        osc.type = "sine";
        osc.frequency.value = 1000;
        gain.gain.setValueAtTime(0.0, ctx.currentTime);
        gain.gain.linearRampToValueAtTime(0.5, ctx.currentTime + 0.02);
        gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.8);
        osc.connect(gain);
        gain.connect(ctx.destination);
        osc.start();
        osc.stop(ctx.currentTime + 0.9);
      } catch (e) {}
    }

    btnRingBell.addEventListener("click", () => {
      ringBellSound();
      bellStatus.textContent = "ãƒãƒ¼ãƒ³â€¦";
      setTimeout(() => { bellStatus.textContent = ""; }, 1500);
    });

    function startIncense(seconds) {
      if (incenseTimerId) {
        clearInterval(incenseTimerId);
        incenseTimerId = null;
      }
      incenseRemaining = seconds;
      updateIncenseStatus();
      incenseButtons.forEach(btn => btn.disabled = true);
      incenseAreaEl.classList.add("active");
      incenseTimerId = setInterval(() => {
        incenseRemaining -= 1;
        if (incenseRemaining <= 0) {
          clearInterval(incenseTimerId);
          incenseTimerId = null;
          incenseStatus.textContent = "ç·šé¦™ãŒç„šãçµ‚ã‚ã‚Šã¾ã—ãŸã€‚";
          incenseButtons.forEach(btn => btn.disabled = false);
          setTimeout(() => {
            incenseStatus.textContent = "";
            incenseAreaEl.classList.remove("active");
          }, 3000);
        } else {
          updateIncenseStatus();
        }
      }, 1000);
    }

    function updateIncenseStatus() {
      incenseStatus.textContent = `ç·šé¦™ï¼šæ®‹ã‚Š ${incenseRemaining} ç§’`;
    }

    incenseButtons.forEach((btn) => {
      btn.addEventListener("click", () => {
        const sec = Number(btn.getAttribute("data-incense") || "0");
        if (sec > 0) {
          startIncense(sec);
        }
      });
    });

    // ==== ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ« ====
    const profileSummaryName = document.getElementById("summaryName");
    const profileSummaryRelation = document.getElementById("summaryRelation");
    const profileSummaryDetail = document.getElementById("summaryDetail");

    const profileNameInput = document.getElementById("profileNameInput");
    const profileRelationInput = document.getElementById("profileRelationInput");
    const profileDeathDateInput = document.getElementById("profileDeathDateInput");
    const profileKaimyoInput = document.getElementById("profileKaimyoInput");
    const profileMemoInput = document.getElementById("profileMemoInput");

    const btnSaveProfile = document.getElementById("btnSaveProfile");
    const btnResetProfile = document.getElementById("btnResetProfile");
    const profileSaveStatus = document.getElementById("profileSaveStatus");

    function formatDateJP(dateStr) {
      if (!dateStr) return "----å¹´--æœˆ--æ—¥ï¼ˆæœªè¨­å®šï¼‰";
      const d = new Date(dateStr);
      if (Number.isNaN(d.getTime())) return "----å¹´--æœˆ--æ—¥ï¼ˆæœªè¨­å®šï¼‰";
      const y = d.getFullYear();
      const m = d.getMonth() + 1;
      const day = d.getDate();
      return `${y}å¹´${m}æœˆ${day}æ—¥ã”ã‚`;
    }

    function defaultNameForProfile() {
      if (currentProfileId === "pet") return "ãƒšãƒƒãƒˆã•ã‚“";
      const found = profileList.find(p => p.id === currentProfileId);
      if (found && found.label) return found.label + " ã•ã‚“";
      return "å±±ç”° å¤ªéƒ ã•ã‚“";
    }

    function defaultRelationForProfile() {
      if (currentProfileId === "grandfather") {
        return "ã‚ãªãŸã®ãŠã˜ã„ã¡ã‚ƒã‚“ï¼ˆçˆ¶æ–¹ï¼‰";
      }
      if (currentProfileId === "grandmother") {
        return "ã‚ãªãŸã®ãŠã°ã‚ã¡ã‚ƒã‚“ï¼ˆæ¯æ–¹ãªã©ï¼‰";
      }
      if (currentProfileId === "pet") {
        return "ã‚ãªãŸã®å¤§åˆ‡ãªå®¶æ—ï¼ˆãƒšãƒƒãƒˆï¼‰";
      }
      return "ã‚ãªãŸã®å¤§åˆ‡ãªäºº";
    }

    function defaultMemoForProfile() {
      if (currentProfileId === "pet") {
        return "ã„ã¤ã‚‚ç™’ã‚„ã—ã‚’ãã‚Œã¦ã‚ã‚ŠãŒã¨ã†ã€‚ã¾ãŸä¸€ç·’ã«éŠã¼ã†ã­ã€‚";
      }
      return "ã„ã¤ã‚‚è¦‹å®ˆã£ã¦ãã‚Œã¦ã‚ã‚ŠãŒã¨ã†ã€‚ç„¡ç†ã—ã™ããšã€å…ƒæ°—ã§éã”ã™ã‚“ã ã‚ˆã€‚";
    }

    function applyProfileToSummary(p) {
      const name = p.name || defaultNameForProfile();
      const relation = p.relation || defaultRelationForProfile();
      const deathText = formatDateJP(p.deathDate);
      const kaimyo = p.kaimyo || "æœªè¨­å®š";
      const memo = p.memo || defaultMemoForProfile();

      profileSummaryName.textContent = name;
      profileSummaryRelation.textContent = relation;
      profileSummaryDetail.innerHTML = `æ²¡å¹´æœˆæ—¥ï¼š${deathText}<br />æˆ’åï¼š${kaimyo}<br />ä¸€è¨€ãƒ¡ãƒ¢ï¼š${memo}`;

      const pStatus = safeLoad(getStorageKey(STORAGE_PORTRAIT_BASE), {});
      if (pStatus.status === PORTRAIT_STATUS.APPROVED) {
        altarPortraitSmallEl.textContent = name;
        altarPortraitSmallEl.classList.add("approved");
      }
    }

    function loadProfile() {
      const saved = safeLoad(getStorageKey(STORAGE_PROFILE_BASE), null);
      if (saved) {
        profileNameInput.value = saved.name || "";
        profileRelationInput.value = saved.relation || "";
        profileDeathDateInput.value = saved.deathDate || "";
        profileKaimyoInput.value = saved.kaimyo || "";
        profileMemoInput.value = saved.memo || "";
        applyProfileToSummary(saved);
      } else {
        profileNameInput.value = "";
        profileRelationInput.value = "";
        profileDeathDateInput.value = "";
        profileKaimyoInput.value = "";
        profileMemoInput.value = "";
        applyProfileToSummary({});
      }
    }

    btnSaveProfile.addEventListener("click", () => {
      const profile = {
        name: profileNameInput.value.trim(),
        relation: profileRelationInput.value.trim(),
        deathDate: profileDeathDateInput.value,
        kaimyo: profileKaimyoInput.value.trim(),
        memo: profileMemoInput.value.trim(),
      };
      safeSave(getStorageKey(STORAGE_PROFILE_BASE), profile);
      applyProfileToSummary(profile);
      profileSaveStatus.textContent = "ã“ã®æ–¹ã®æƒ…å ±ã‚’ã€ã“ã®ç«¯æœ«ã«ä¿å­˜ã—ã¾ã—ãŸ";
      setTimeout(() => { profileSaveStatus.textContent = ""; }, 2500);
    });

    btnResetProfile.addEventListener("click", () => {
      profileNameInput.value = "";
      profileRelationInput.value = "";
      profileDeathDateInput.value = "";
      profileKaimyoInput.value = "";
      profileMemoInput.value = "";
      safeSave(getStorageKey(STORAGE_PROFILE_BASE), {});
      applyProfileToSummary({});
      profileSaveStatus.textContent = "å…¥åŠ›ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ";
      setTimeout(() => { profileSaveStatus.textContent = ""; }, 2500);
    });

    // ==== ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«åˆ¥ã®ãƒ‡ãƒ¼ã‚¿èª­è¾¼ ====
    function loadPortraitStatusForProfile() {
      const savedPortrait = safeLoad(getStorageKey(STORAGE_PORTRAIT_BASE), null);
      if (savedPortrait && savedPortrait.status) {
        updatePortraitUI(savedPortrait.status);
      } else {
        updatePortraitUI(PORTRAIT_STATUS.UNSUBMITTED);
      }
    }

    function loadAltarForProfile() {
      const savedAltar = safeLoad(getStorageKey(STORAGE_ALTAR_BASE), null);
      if (savedAltar) {
        if (savedAltar.style) {
          altarStyleSelectEl.value = savedAltar.style;
          applyAltarStyle(savedAltar.style);
        } else {
          altarStyleSelectEl.value = "basic";
          applyAltarStyle("basic");
        }
        if (savedAltar.items) {
          altarItemsInputEl.value = savedAltar.items;
          applyAltarItems(savedAltar.items);
        } else {
          altarItemsInputEl.value = "";
          applyAltarItems("");
        }
      } else {
        altarStyleSelectEl.value = "basic";
        applyAltarStyle("basic");
        altarItemsInputEl.value = "";
        applyAltarItems("");
      }
    }

    function switchProfile(id) {
      currentProfileId = id;
      renderProfileChips();
      loadProfile();
      loadPortraitStatusForProfile();
      loadAltarForProfile();
    }

    // ==== åˆæœŸåŒ– ====
    (function init() {
      loadProfileList();
      renderProfileChips();
      switchProfile(currentProfileId);
    })();
  </script>
</body>
</html>
